
<view class="page">
  <!-- èƒŒæ™¯å›¾å±‚ï¼ˆå……æ»¡æ•´ä¸ª .pageï¼Œé«˜åº¦éšå†…å®¹å¢é•¿ï¼‰ -->
  <view class="bg-image"></view>
  
  <!-- æ­¥éª¤æŒ‡ç¤ºå™¨ -->
  <view class="step-indicator">
    <view class="step-dots">
      <view class="dot {{currentStep === index ? 'active' : ''}}" 
            tt:for="{{stepTitles}}" tt:key="index" tt:for-index="index">
      </view>
    </view>
    <text class="step-title">{{stepTitles[currentStep]}}</text>
    
    <!-- è¿›åº¦æ¡ -->
    <view class="progress-container">
      <view class="progress-bar">
        <view class="progress-fill" style="width: {{progressPercentage}}%"></view>
      </view>
      <text class="progress-text">{{progressPercentage}}%</text>
    </view>
  </view>

  <!-- æ»‘åŠ¨å®¹å™¨ -->
  <view class="swipe-container">
    <swiper class="swiper" 
            current="{{currentStep}}" 
            bindchange="onSwiperChange"
            disable-touch="{{false}}">
      
      <!-- æ­¥éª¤1: åŸºæœ¬ä¿¡æ¯ï¼ˆè®¡åˆ’åç§°ã€æ—¶é—´èŒƒå›´ã€é¢„ç®—èŒƒå›´ï¼‰ -->
      <swiper-item>
        <scroll-view scroll-y="true" class="step-content">
        
          <view class="step-header">
            <text class="step-number">1</text>
            <text class="step-label">åŸºæœ¬ä¿¡æ¯</text>
          </view>
          
          <!-- è®¡åˆ’åç§° -->
          <view class="input-section">
            <view class="section-title">è®¡åˆ’åç§°</view>
            <view class="card-input">
              <input class="ipt" 
                     placeholder="è¯·è¾“å…¥å›¢å»ºè®¡åˆ’åç§°" 
                     value="{{form.planName}}" 
                     bindinput="onPlanNameInput" />
            </view>
          </view>

          <!-- æ¸¸ç©æ—¶é—´ -->
          <view class="time-section">
            <view class="section-title">æ¸¸ç©æ—¶é—´</view>
            <view class="time-row">
              <text class="time-label">å¼€å§‹æ—¥æœŸ</text>
              <picker mode="date" value="{{form.startDate}}" bindchange="onStartDateChange">
                <view class="picker-input">
                  <text class="picker-text">{{form.startDate || 'é€‰æ‹©æ—¥æœŸ'}}</text>
                  <text class="picker-arrow">></text>
                </view>
              </picker>
            </view>
            <view class="time-row">
              <text class="time-label">ç»“æŸæ—¥æœŸ</text>
              <picker mode="date" value="{{form.endDate}}" bindchange="onEndDateChange">
                <view class="picker-input">
                  <text class="picker-text">{{form.endDate || 'é€‰æ‹©æ—¥æœŸ'}}</text>
                  <text class="picker-arrow">></text>
                </view>
              </picker>
            </view>
            <view class="time-row">
              <text class="time-label">{{form.startDate === form.endDate ? 'å¼€å§‹æ—¶é—´' : 'ç¬¬ä¸€å¤©å¼€å§‹æ—¶é—´'}}</text>
              <picker mode="time" value="{{form.startTime}}" bindchange="onStartTimeChange">
                <view class="picker-input">
                  <text class="picker-text">{{form.startTime || 'é€‰æ‹©æ—¶é—´'}}</text>
                  <text class="picker-arrow">></text>
                </view>
              </picker>
            </view>
            <view class="time-row">
              <text class="time-label">{{form.startDate === form.endDate ? 'ç»“æŸæ—¶é—´' : 'æœ€åä¸€å¤©ç»“æŸæ—¶é—´'}}</text>
              <picker mode="time" value="{{form.endTime}}" bindchange="onEndTimeChange">
                <view class="picker-input">
                  <text class="picker-text">{{form.endTime || 'é€‰æ‹©æ—¶é—´'}}</text>
                  <text class="picker-arrow">></text>
                </view>
              </picker>
            </view>
            <view class="time-hint">
              <text class="hint-text">
                {{form.startDate === form.endDate ? '' : 'ğŸ’¡ å¤šå¤©æ´»åŠ¨ï¼Œå¼€å§‹æ—¶é—´ä¸ºç¬¬ä¸€å¤©å¼€å§‹æ—¶é—´ï¼Œç»“æŸæ—¶é—´ä¸ºæœ€åä¸€å¤©ç»“æŸæ—¶é—´'}}
              </text>
            </view>
          </view>

          <!-- é¢„ç®—åŒºé—´ -->
          <view class="budget-section">
            <view class="section-title">é¢„ç®—åŒºé—´</view>
            <view class="budget-type">
              <view class="chip {{form.budgetMode === 'percapita' ? 'active' : ''}}" 
                    bindtap="onBudgetModeChange" data-mode="percapita">
                <text class="chip-text">äººå‡é¢„ç®—</text>
              </view>
              <view class="chip {{form.budgetMode === 'total' ? 'active' : ''}}" 
                    bindtap="onBudgetModeChange" data-mode="total">
                <text class="chip-text">æ€»é¢„ç®—</text>
              </view>
            </view>
            <view class="budget-range">
              <view class="budget-input">
                <text class="budget-label">æœ€ä½</text>
                <input class="budget-ipt" 
                       type="number" 
                       placeholder="0" 
                       value="{{form.budgetMin}}" 
                       bindinput="onBudgetMinInput" />
                <text class="budget-unit">å…ƒ</text>
              </view>
              <view class="budget-input">
                <text class="budget-label">æœ€é«˜</text>
                <input class="budget-ipt" 
                       type="number" 
                       placeholder="0" 
                       value="{{form.budgetMax}}" 
                       bindinput="onBudgetMaxInput" />
                <text class="budget-unit">å…ƒ</text>
              </view>
            </view>
            <view class="people-input">
              <text class="people-label">å‚ä¸äººæ•°</text>
              <input class="people-ipt" 
                     type="number" 
                     placeholder="è¯·è¾“å…¥å‚ä¸äººæ•°" 
                     value="{{form.peopleCount}}" 
                     bindinput="onPeopleCountInput" />
              <text class="people-unit">äºº</text>
            </view>
          </view>
        </scroll-view>
      </swiper-item>

      <!-- æ­¥éª¤2: åœ°ç‚¹è®¾ç½®ï¼ˆé€‰æ‹©å‡ºå‘ç‚¹ã€å¯æ¥å—èŒƒå›´ï¼‰ -->
      <swiper-item>
        <scroll-view scroll-y="true" class="step-content">
          <view class="step-header">
            <text class="step-number">2</text>
            <text class="step-label">åœ°ç‚¹è®¾ç½®</text>
          </view>
          
          <!-- é€‰æ‹©å‡ºå‘ç‚¹ -->
          <view class="location-section">
            <view class="section-title">é€‰æ‹©å‡ºå‘ç‚¹</view>
            
            <!-- æœç´¢æ¡† -->
            <view class="search-section">
              <view class="search-input-container">
                <input class="search-input" 
                       placeholder="æœç´¢åœ°ç‚¹ä½œä¸ºå‡ºå‘ç‚¹" 
                       value="{{searchKeyword}}" 
                       bindinput="onSearchInput"
                       bindconfirm="onSearchConfirm" />
                <view class="search-btn" bindtap="onSearchConfirm">
                  <text class="search-icon">ğŸ”</text>
                </view>
              </view>
              
              <!-- æœç´¢ç»“æœåˆ—è¡¨ -->
              <view class="search-results" tt:if="{{searchResults.length > 0}}">
                <view class="search-result-item" 
                      tt:for="{{searchResults}}" 
                      tt:key="index" 
                      tt:for-item="item" 
                      tt:for-index="index"
                      bindtap="onSelectSearchResult" 
                      data-item="{{item}}">
                  <text class="result-name">{{item.name}}</text>
                  <text class="result-address">{{item.address}}</text>
                </view>
              </view>
            </view>
            
            <!-- åœ°å›¾åŒºåŸŸ -->
            <view class="mapbox">
              <map class="map" 
                   longitude="{{form.origin.longitude}}" 
                   latitude="{{form.origin.latitude}}"
                   scale="16"
                   markers="{{mapState.markers}}"
                   bindmarkertap="onMarkerTap"
                   bindtap="onMapTap">
              </map>
              
              <!-- åœ°å›¾æ§ä»¶ -->
              <view class="map-controls">
                <view class="zoom">
                  <view class="zoom-btn" bindtap="zoomIn">+</view>
                  <view class="zoom-btn" bindtap="zoomOut">-</view>
                </view>
                <view class="location-btn" bindtap="getCurrentLocation">ğŸ“</view>
              </view>
            </view>
            
            <!-- ä½ç½®ä¿¡æ¯æ˜¾ç¤º -->
            <view class="location-display">
              <text class="location-name">{{form.origin.name || 'è¯·é€‰æ‹©å‡ºå‘ç‚¹'}}</text>
              <text class="location-address">{{form.origin.address || 'ç‚¹å‡»åœ°å›¾é€‰æ‹©ä½ç½®'}}</text>
            </view>
          </view>

          <!-- å¯æ¥å—èŒƒå›´ -->
          <view class="range-section">
            <view class="section-title">åœ°ç‚¹è·ç¦»èŒƒå›´</view>
            <view class="range-item">
              <text class="range-label">è·ç¦»èŒƒå›´ï¼š{{form.distance}} km</text>
              <slider class="slider" 
                      min="0" max="30" step="1" value="{{form.distance}}"
                      bindchanging="onDistanceChanging" bindchange="onDistanceChange" />
            </view>
            <view class="range-item">
              <text class="range-label">å…¬å…±äº¤é€šï¼š{{form.maxTransitTime}} åˆ†é’Ÿ</text>
              <slider class="slider" 
                      min="0" max="75" step="5" value="{{form.maxTransitTime}}"
                      bindchange="onTransitChange" />
            </view>
            <view class="range-item">
              <text class="range-label">æ‰“è½¦æ—¶é—´ï¼š{{form.taxiTime}} åˆ†é’Ÿ</text>
              <slider class="slider" 
                      min="0" max="90" step="5" value="{{form.taxiTime}}"
                      bindchange="onTaxiChange" />
            </view>
          </view>
        </scroll-view>
      </swiper-item>

      <!-- æ­¥éª¤3: ä¸ªæ€§åŒ–è®¾ç½®ï¼ˆå›¢å»ºç±»å‹é€‰æ‹©ã€å¤‡æ³¨ï¼‰ -->
      <swiper-item>
        <scroll-view scroll-y="true" class="step-content-per">
          <view class="step-header">
            <text class="step-number">3</text>
            <text class="step-label">ä¸ªæ€§åŒ–éœ€æ±‚</text>
          </view>
            
          <!-- å›¢å»ºç±»å‹ -->
          <view class="type-section">
            <view class="notes-input">
              <textarea class="notes-textarea" 
                        placeholder="åœ¨è¿™é‡Œè¾“å…¥ç‹¬å±äºä½ çš„éœ€æ±‚ï¼eg:å¯ä»¥æºœå†°çš„å•†åœºï¼Œæœ‰è¹¦åºŠçš„å…¬å›­" 
                        value="{{form.otherNotes}}" 
                        bindinput="onOtherNotesInput"
                        maxlength="500"></textarea>
              <text class="notes-count">{{form.otherNotes.length}}/500</text>
            </view>
            <text class="hint-text">
                ğŸ’¡ åœ¨å¯¹è¯æ¡†ä¸­è¾“å…¥ä½ çš„ä»»ä½•ä¸ªæ€§åŒ–éœ€æ±‚ï¼ˆå¯é€‰ï¼‰
              </text>
          </view>
        </scroll-view>
      </swiper-item>

    </swiper>
  </view>

  <!-- å¯¼èˆªæŒ‰é’® -->
  <view class="navigation">
    <view class="nav-btn {{currentStep === 0 ? 'disabled' : ''}}" 
          bindtap="onPrevStep">
      <text class="nav-arrow">â€¹</text>
    </view>
    <view class="nav-btn {{currentStep === stepTitles.length - 1 ? 'disabled' : ''}}" 
          bindtap="onNextStep">
      <text class="nav-arrow">â€º</text>
    </view>
  </view>

  <!-- åº•éƒ¨æ“ä½œæŒ‰é’® -->
  <view class="bottom-actions">
    <view class="btn-generate {{isGenerating ? 'generating' : ''}}" bindtap="onGeneratePlan">
      <text class="btn-text"> {{generateButtonText}}</text>
    </view>
    
    <!-- æ˜Ÿæ˜Ÿè¿¸å‘åŠ¨ç”»å®¹å™¨ -->
    <view class="star-burst-container" tt:if="{{isGenerating}}">
      <view class="star {{star.animation}}" 
            tt:for="{{burstStars}}" 
            tt:key="index" 
            tt:for-item="star" 
            tt:for-index="index"
            style="animation-delay: {{star.delay}}s;">
        â­
      </view>
    </view>
  </view>
   <movable-area class="movable-area-fullscreen">
  
    <!-- å¯æ‹–åŠ¨çš„è§†å›¾ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬çš„å°äººå®¹å™¨ -->
    <movable-view 
      class="movable-gif-view" 
      direction="all" 
      x="{{gifX}}" 
      y="{{gifY}}"
    >
      <!-- ä½ çš„å›¾ç‰‡ç°åœ¨æ”¾åœ¨å¯æ‹–åŠ¨è§†å›¾çš„å†…éƒ¨ -->
      <image class="floating-gif-inner" src="https://pixe1ran9e.oss-cn-hangzhou.aliyuncs.com/GIF-unscreen.gif" mode="widthFix"></image>
    </movable-view>
    
  </movable-area>
</view>