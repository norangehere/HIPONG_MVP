<view class="page">
  <view class="bg-conic"></view>

  <view class="top-entry" bindtap="openFavorites">
    <text class="top-entry-text">ç‚¹å‡»æ”¶è—æ­¤æ–¹æ¡ˆ</text>
  </view>

  <block tt:if="{{generatedPlan}}">
    <text class="main-title">æ‚¨çš„å›¢å»ºæ–¹æ¡ˆ</text>
    <view class="plan-summary">
      <text class="plan-title">{{generatedPlan.title}}</text>
      
      <!-- é¢„ç®—ä¿¡æ¯æ˜¾ç¤º -->
      <view class="budget-info">
        <text class="budget-title">ğŸ’° é¢„ç®—ä¿¡æ¯</text>
        <view class="budget-details">
          <text class="budget-item">å‚ä¸äººæ•°ï¼š{{planForm.peopleCount}}äºº</text>
          <text class="budget-item">æ´»åŠ¨é¢„ç®—ï¼š{{generatedPlan.budgetInfo.perCapitaCost}}å…ƒ/äºº</text>
          <block tt:if="{{generatedPlan.budgetInfo.hotelCost > 0}}">
            <text class="budget-item">é…’åº—è´¹ç”¨ï¼š{{generatedPlan.budgetInfo.hotelCost}}å…ƒ/äºº</text>
          </block>
          <text class="budget-item">æ€»é¢„ç®—ï¼š{{generatedPlan.budgetInfo.totalBudget}}å…ƒ</text>
        </view>
      </view>
      
      <!-- é…’åº—ä¿¡æ¯ï¼ˆå¤šå¤©è¡Œç¨‹æ—¶æ˜¾ç¤ºï¼‰ -->
      <block tt:if="{{isMultiDay && hotelInfo}}">
        <view class="hotel-section">
          <text class="hotel-title">ğŸ¨ ä½å®¿å®‰æ’</text>
          <view class="hotel-info">
            <text class="hotel-name">{{hotelInfo.name}}</text>
            <text class="hotel-address">{{hotelInfo.address}}</text>
            <text class="hotel-time">å…¥ä½ï¼š{{hotelInfo.checkin}} | é€€æˆ¿ï¼š{{hotelInfo.checkout}}</text>
            <text class="hotel-cost">æ€»å…±èŠ±è´¹: {{hotelInfo.cost}} </text>
            <text class="hotel-desc">{{hotelInfo.description}}</text>
          </view>
        </view>
      </block>

      <!-- å¤šå¤©è¡Œç¨‹çš„å¤©æ ‡ç­¾ -->
      <block tt:if="{{isMultiDay && dayTabs.length > 0}}">
        <view class="day-tabs">
          <view class="day-tab {{currentDayIndex === index ? 'active' : ''}}" 
                tt:for="{{dayTabs}}" tt:key="day" tt:for-index="index"
                data-index="{{index}}" bindtap="onDayTabChange">
            <text class="day-tab-text">{{item.label}}</text>
          </view>
        </view>
      </block>

      <!-- æ´»åŠ¨åˆ—è¡¨ -->
      <view class="plan-activities">
        <block tt:for="{{recoList}}" tt:key="id">
          <view class="activity-item">
            <view style="display: flex; align-items: baseline; margin-bottom: 8rpx;">
              <text class="activity-time">{{item.time}}</text>
              <text class="activity-name">{{item.name}}</text>
            </view>
            <block tt:if="{{item.photoUrl}}">
              <image class="activity-image" src="{{item.photoUrl}}" mode="aspectFill" />
            </block>
            <view class="travel-options">
              <text class="activity-desc" style="color: #3c89ff;">è·ç¦»ï¼š</text>
              <block tt:if="{{item.distance && item.distance !== 'æœªçŸ¥'}}">
                <text class="travel-option">çº¦ {{item.distance}}km</text>
              </block>
              <block tt:else>
                <text class="travel-option">è·ç¦»æœªçŸ¥</text>
              </block>
            </view>
            <text class="activity-desc">{{item.description}}</text>
          </view>
        </block>
      </view>
    </view>

    <view class="feedback-section">
      <text class="section-title">ä¸æ»¡æ„ï¼Ÿå‘Šè¯‰æˆ‘ä»¬æ‚¨çš„éœ€æ±‚</text>
      <view class="card-input">
        <input class="ipt" placeholder="ä¾‹å¦‚ï¼šé¢„ç®—å¤ªé«˜/æƒ³å¢åŠ æˆ·å¤–æ´»åŠ¨" 
               value="{{feedback}}" bindinput="onFeedbackInput" />
      </view>
      <view class="btn-recommend" bindtap="onRegenerate">
        <text class="btn-text">é‡æ–°è°ƒæ•´æ–¹æ¡ˆ</text>
      </view>
    </view>
  </block>

  <text class="main-title">ç›®çš„åœ°é€Ÿè§ˆ</text>
  <scroll-view class="hscroll" scroll-x="true" show-scrollbar="false">
    <view class="htrack">
      <view class="card" tt:for="{{recoList}}" tt:key="id">        
        <view class="card-body">
          <view class="row">
            <text class="name">{{item.name}}</text>
            <view class="icon-like {{item.liked ? 'alt' : ''}}" 
                  data-index="{{index}}" 
                  bindtap="onFavoritePlace"></view>
          </view>
          <block tt:if="{{item.distance && item.distance !== 'æœªçŸ¥'}}">
            <text class="meta">è·ç¦»çº¦ {{item.distance}}km</text>
          </block>
          <block tt:else>
            <text class="meta">è·ç¦»æœªçŸ¥</text>
          </block>
        </view>
      </view>
    </view>
  </scroll-view>

  <text class="section-title">ç›¸ä¼¼é«˜åˆ†æ–¹æ¡ˆæ¨è</text>
  <scroll-view class="hscroll" scroll-x="true" show-scrollbar="false">
    <view class="htrack">
      <view class="card" tt:for="{{similarList}}" tt:key="id">
        <view class="card-body">
          <view class="row">
            <text class="name">{{item.name}}</text>
            <view class="icon-like alt"></view>
          </view>
          <text class="meta">Â· å…¬å…±äº¤é€š{{item.transit}}min</text>
          <text class="meta">Â· é©¾è½¦{{item.drive}}min</text>
          <text class="meta">Â· äººå‡ï¿¥{{item.price}}</text>
        </view>
      </view>
    </view>
  </scroll-view>
</view>